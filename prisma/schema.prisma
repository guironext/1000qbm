// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Status {
  NEW
  VALIDATED
  CURRENT
}

model Stage {
  id             String            @id @default(uuid())
  langue         Langue
  title          String
  statusStage    Status            @default(NEW)
  niveau         String
  valide         Boolean           @default(false)
  image          String
  numOrder       Int
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  compterSection CompteurSection[]
  descriptions   Paragraphe[]
  jeux           Jeu[]
  palmares       Palmares[]
}

model Paragraphe {
  id      String  @id @default(uuid())
  texte   String
  stageId String?
  stage   Stage?  @relation(fields: [stageId], references: [id])
}

model Section {
  id             String            @id @default(uuid())
  title          String
  langue         Langue
  statusSection  Status            @default(NEW)
  image          String
  niveau         String
  valide         Boolean           @default(false)
  numOrder       Int
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  jeux           Jeu[]
  palmares       Palmares[]
  compterSection CompteurSection[]
}

model Jeu {
  id        String  @id @default(uuid())
  langue    Langue
  image     String?
  niveau    String
  statusJeu Status  @default(NEW)
  numOrder  Int
  valide    Boolean @default(false)
  stageId   String
  stage     Stage?  @relation(fields: [stageId], references: [id])

  sectionId String?
  section   Section? @relation(fields: [sectionId], references: [id])

  questions Question[]
  palmares  Palmares[]
}

model Question {
  id       String    @id @default(uuid())
  langue   Langue
  intitule String
  orderNum Int
  status   Status    @default(NEW)
  valide   Boolean   @default(false)
  reponses Reponse[]

  jeuId String?
  jeu   Jeu?    @relation(fields: [jeuId], references: [id])
}

model Reponse {
  id        String  @id @default(uuid())
  intitule  String
  langue    Langue
  isCorrect Boolean

  questionId String?
  question   Question? @relation(fields: [questionId], references: [id])
}

model User {
  id             String            @id @default(uuid())
  clerkId        String            @unique
  email          String            @unique
  langue         String?           @default("FR")
  firstName      String
  lastName       String
  country        String?
  phone          String?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  role           UserRole          @default(JOUEUR)
  palmares       Palmares[]
  compterSection CompteurSection[]
  boardIndex     BoardIndex?

}


enum UserRole {
  ADMIN
  JOUEUR
  MANAGER
}

model BoardIndex {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  play1  Int @default(1)
  play2  Int @default(2)
  play3  Int @default(3)
  play4  Int @default(4)
  play5  Int @default(5)
  play6  Int @default(6)
  play7  Int @default(7)
  play8  Int @default(8)
  play9  Int @default(9)
  play10 Int @default(10)
  play11 Int @default(11)
  play12 Int @default(12)
  play13 Int @default(13)
  play14 Int @default(14)
  play15 Int @default(15)
  play16 Int @default(16)
  play17 Int @default(17)
  play18 Int @default(18)
  play19 Int @default(19)
  play20 Int @default(20)
  play21 Int @default(21)
  play22 Int @default(22)
  play23 Int @default(23)
  play24 Int @default(24)
  play25 Int @default(25)
}

model Palmares {
  id String @id @default(uuid())

  userId String?
  user   User?   @relation(fields: [userId], references: [id])

  stageId     String?
  stage       Stage?  @relation(fields: [stageId], references: [id])

  statusStage Status  @default(NEW)
  stageNumOrder Int
  stageLength Int @default(1)

  sectionId     String?
  section       Section? @relation(fields: [sectionId], references: [id])

  statusSection Status   @default(NEW)
  sectionNumOrder Int

  jeuId     String?
  jeu       Jeu?    @relation(fields: [jeuId], references: [id])

  statusJeu Status  @default(NEW)
  niveau    String

  langue           Langue
  numOrder         Int
  score            Int
  isFinished       Boolean @default(false)
  jeuValide        Boolean @default(false)
  createdAt        DateTime          @default(now())
  compterSection   CompteurSection[]

}

model CompteurSection {
  id    String @id @default(uuid())
  count Int    @default(1)

  stageId String
  stage   Stage  @relation(fields: [stageId], references: [id])

  userId String?
  user   User?   @relation(fields: [userId], references: [id])

  sectionId String
  section   Section @relation(fields: [sectionId], references: [id])

  palmaresId String?
  palmares   Palmares? @relation(fields: [palmaresId], references: [id])
}

enum Langue {
  FR
  EN
  ES
  PT
  DE
}
